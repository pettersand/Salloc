{% extends "layout.html" %}

{% block title %}
Index
{% endblock %}

{% block main %}
<div class="container-index">
    <div class="container-main">
        <div class="table-half">
            <div class="table-group">
                <div class="container-header">
                    <h4>Transaction History</h4><br>
                </div>
                    <div class="item">
                        <table>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Post</th>
                                <th>Notes</th>
                            </tr>
                            {% for hist in history %}
                            <tr>
                                <td>{{ hist[0] }}</td>
                                <td>{{ hist[2] }}</td>
                                <td>{{ "{:,.0f} kr".format(hist[3]) }}</td>
                                <td>{{ hist[1] }}</td>
                                <td>{{ hist[4] }}</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div> 
            </div>
    <div class="container-half">
        <div class="container-group">
            <label for="container-group"><h3>Deposit:</h3></label>
            <div class="item">
                <form action="/deposit" method="post">
                    <label for="deposit">General Deposit:</label>
                    <input type="number" id="deposit" name="deposit" placeholder="Enter amount" required>
                    <div class="info-container">
                        <input type="hidden" id="remainder" name="remainder" value="{{ remainder }}">
                        <input class="info-button" type="submit" id="depositButton" value="Submit">
                        <span class="info-icon" onclick="showInfo(event);">
                            <i class="fa-solid fa-info-circle"></i>
                        <span>
                    </div>
                </form>
            </div>
            <div class="item">
                <form action="/specific_deposit" method="post">
                    <label for="deposit">Specific Deposit:</label>
                    <select id="post" name="post" required>
                        <option value="" disabled selected>Select Post</option>
                        {% for post in posts %}
                        <option value="{{ post[0] }}">{{ post[0] }}</option>
                        {% endfor %}
                    </select>
                    <input type="number" id="deposit" name="deposit" placeholder="Enter amount" required>
                    <div class="info-container">
                        <input type="hidden" id="remainder" name="remainder" value="{{ remainder }}">
                        <input class="info-button" type="submit" id="specificDepositButton" value="Submit">
                        <span class="info-icon" onclick="showInfo(event);">
                            <i class="fa-solid fa-info-circle"></i>
                        <span>
                    </div>
                </form>
            </div> 
        </div>
        <div class="container-group">
            <label for="container-group">
                <h3>Withdrawal:</h3></label>
            <div class="item">
                <form action="/withdrawal" method="post">
                    <label for="withdrawal">Withdrawal:</label>
                    <select id="post" name="post" required>
                        <option value="" disabled selected>From post</option>
                        {% for post in posts %}
                        <option value="{{ post[0] }}">{{ post[0] }}</option>
                        {% endfor %}
                    </select>
                    <input type="number" id="withdrawal" name="withdrawal" placeholder="Enter amount" required>
                    <input type="text" id="notes" name="notes" placeholder="Notes" required>
                    <div class="info-container">
                        <input type="hidden" id="remainder" name="remainder" value="{{ remainder }}">
                        <input class="info-button" type="submit" id="withdrawButton" value="Submit">
                        <span class="info-icon" onclick="showInfo(event);">
                            <i class="fa-solid fa-info-circle"></i>
                        <span>
                    </div>
                </form>
            </div>
        </div>
        <div class="container-group">
            <label for="container-group"><h3>Manage Funds:</h3></label>
            <div class="item">
                <form action="/move" method="post">
                    <label for="move">Move Funds:</label>
                    <select id="from" name="from" required>
                        <option value="" disabled selected>From post</option>
                        {% for post in posts %}
                        <option value="{{ post[0] }}">{{ post[0] }}</option>
                        {% endfor %}
                    </select>
                    <select id="to" name="to" required>
                        <option value="" disabled selected>To post</option>
                        {% for post in posts %}
                        <option value="{{ post[0] }}">{{ post[0] }}</option>
                        {% endfor %}
                    </select>
                    <input type="number" id="amount" name="amount" placeholder="Enter amount" required>
                    <div class="info-container">
                        <input type="hidden" id="remainder" name="remainder" value="{{ remainder }}">
                        <input class="info-button" type="submit" id="moveFundsButton" value="Submit">
                        <span class="info-icon" onclick="showInfo(event);">
                            <i class="fa-solid fa-info-circle"></i>
                        <span>
                    </div>
                </form>
            </div>
            <div class="item">
                <form action="/transfer" method="post">
                    <label for="move">Transfer & Delete</label>
                    <select id="from" name="from" required>
                        <option value="" disabled selected>From post</option>
                        {% for post in posts %}
                        <option value="{{ post[0] }}">{{ post[0] }}</option>
                        {% endfor %}
                    </select>
                    <select id="type" name="type" required>
                        <option value="" disabled selected required>Type</option>
                        <option value="general">General</option>
                        <option value="specific">Specific</option>
                    </select>
                    <select id="to" name="to">
                        <option value="" disabled selected>To post</option>
                        {% for post in posts %}
                        <option value="{{ post[0] }}">{{ post[0] }}</option>
                        {% endfor %}
                    </select>
                    <div class="info-container">
                        <input type="hidden" id="remainder" name="remainder" value="{{ remainder }}">
                        <input class="info-button" type="submit" id="transferFundsButton" value="Submit">
                        <span class="info-icon" onclick="showInfo(event);">
                            <i class="fa-solid fa-info-circle"></i>
                        <span>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
    <div class="container-table">
        <div class="container-header">
            <h4>Post Overview</h4><br>
        </div>
            <div class="div-table">
                <div class="flex-row">
                    <div class="flex-post-h sortable">Post Name</div>
                    <div class="flex-saved-h sortable">Saved</div>
                    <div class="flex-goal-h sortable">Goal</div>
                    <div class="flex-progress-h sortable">Progress</div>
                    <div class="flex-salloc-h sortable">Salloc (<span id="remainingAllocationCounter">{{ remain_alloc }}</span>% Left)</div>
                    <input type="hidden" id="hiddenRemainAlloc" value="{{ remain_alloc }}">
                </div>
                {% for post in posts %}
                <div class="flex-row">
                    <div class="flex-post" contenteditable="true" data-old-name="{{ post[0] }}" data-field="post_name">
                        {{ post[0] }}
                    </div>
                    <div class="flex-saved">{{ "{:,.0f} kr".format(post[2]) }}</div>
                    <div class="flex-goal" contenteditable="true" data-field="goal">
                        <span>{{ "{:,.0f} kr".format(post[3]) }}</span>
                    </div>
                    <div class="flex-progress">
                        <progress value="{{ post[2] }}" max="{{ post[3] }}"></progress>
                    </div>
                    <div class="flex-salloc" contenteditable="true" data-field="salloc">
                        <span>{{ post[1]|int }}</span>
                    </div>
                    <div>%</div>
                </div>
                {% endfor %}   
            </div>
            <button id="updateButton">Update Changes</button>
    </div>
</div>
{% endblock %}
{% block  sidebar %}
<div class="sidebar container"> 
    <div class="container-header">
        <h4>Account</h4><br>
    </div>
    <div class="side-container">
        <div class="item">
            <p>Current Savings: <br>{{ balance }} kr</p><br>
            <p>Total Goal: <br>{{ total_goal }} kr</p><br><br>
            <span>
                <button id="profileSettingsButton">Profile Settings</button>
            </span>
        </div>
        <div class="item">
            <span>Funds not yet allocated: <br>{{ remainder }} kr</span>
            <form action="/undefined" method="post">
                <label for="undefined">Allocate now?</label>
                <select id="post" name="post" required>
                    <option value="" disabled selected>Select Post</option>
                    <option value="general">All by %</option>
                    {% for post in posts %}
                    <option value="{{ post[0] }}">{{ post[0] }}</option>
                    {% endfor %}   
                </select>
                <div class="info-container">
                    <input type="hidden" id="remainder" name="remainder" value="{{ remainder }}">
                    <input class="info-button" type="submit" id="allocateButton" value="Allocate">
                    <span class="info-icon" onclick="showInfo(event);">
                        <i class="fa-solid fa-info-circle"></i>
                    <span>
                </div>
            </form>
        </div>
        <div class="item">
            <form id="resetAccountForm" action="/reset" method="post">
                <label>Reset Account</label>
                <input class="info-button" id="resetAccountButton"  type="submit" value="Reset">
            </form>
        </div>
        <div class="item">
            <form id="resetPostsForm" action="/reset_posts" method="post">
                <label>Reset Posts</label>
                <input class="info-button" id="resetPostsButton"  type="submit" value="Reset">
            </form>
        </div>
    </div> 
    <div class="container-header">
        <h4>Setup / Controls</h4><br>
    </div>
    <div class="side-container">
        <div class="item">
            <form action="/set_savings" method="post">
                <label for="savings">Set Total Savings:</label>
                <input type="number" id="savings" name="savings" placeholder="Enter total savings" required>
                <div class="info-container">
                    <input class="info-button" id="setSavings" type="submit" value="Submit">
                    <span class="info-icon" onclick="showInfo(event);">
                        <i class="fa-solid fa-info-circle"></i>
                    <span>
                </div>
            </form>
        </div>
        <div class="item">
            <form id="removePostForm" action="/remove_post" method="post">
                <label for="post">Remove Post:</label>
                <select id="post" name="post" required>
                    <option value="" disabled selected>Select Post</option>
                    {% for post in posts %}
                    <option value="{{ post[0] }}">{{ post[0] }}</option>
                    {% endfor %}
                </select>
                <div class="info-container">
                    <input class="info-button" type="button" id="removePostButton" value="Remove">
                    <span class="info-icon" onclick="showInfo(event);">
                        <i class="fa-solid fa-info-circle"></i>
                    <span>
                </div>
            </form>
        </div>
        <div class="item">
            <form id="setupCustomTemplate">
                <label for="custom">Add Posts</label>
                <div class="info-container">
                    <input class="info-button" id="setupButton" type="submit" value="Custom Post Setup">
                    <span class="info-icon" onclick="showInfo(event);">
                        <i class="fa-solid fa-info-circle"></i>
                    <span>
                </div>
            </form>
        </div>
        <div class="item">
            <form id="generateTemplate" action="/generate_template" method="post">
                <label for="generate">Generate Template</label>
                    <div class="info-container">
                        <input class="info-button" id="generateTemplateButton" type="submit" value="Generate Example">
                        <span class="info-icon" onclick="showInfo(event);">
                            <i class="fa-solid fa-info-circle"></i>
                        <span>
                    </div>
            </form>
        </div>
        <div class="item">
            <form id="commitSavingsForm" action="/commit_savings" method="post">
                <label>Commit Changes</label>
                <div class="info-container">
                    <input class="info-button" id="commitSavingsButton" type="submit" value="Calculate">
                    <span class="info-icon" onclick="showInfo(event);">
                        <i class="fa-solid fa-info-circle"></i>
                    <span>
                </div>
            </form>
        </div>
    </div> 
    <div class="container-header">
        <h4>Alerts</h4><br>
    </div>
    <div class="alerts-container">

            {% for alert in alerts %}
            <div class="alert">
                {{ alert }}
            </div>
        {% endfor %}

    </div> 
</div>
{% endblock %}

